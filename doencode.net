#!/bin/bash
hosts=localhost,event1,event2,event3,event4,event5,europa,oberon,hyperion


cd $HOME
# get list of queue dirs to work on, starting with the oldest
for dir in `ls -1dtr abcde.[a-f0-9]*`; do 
  # get track count
  lasttrack=`awk -F= '/cdparanoia-audio-tracks/ {print $NF}' ${dir}/status`
  # if we couldn't get it, move to the next dir.
  [ "x$lasttrack" == "x" ] && continue
  # if the last track isn't done reading, move on.
  grep -q "^readtrack-${lasttrack:?}" ${dir:?}/status || continue
  
  discid=`echo ${dir}|awk -F. '{print $NF}'`
  
  abcde -p -k -N -U -r ${hosts:?} -a normalize,encode,tag,move -C ${discid:?}
done

exit 0
cat > /dev/null << END

  This is abcde v2.4.
Usage: abcde [options] [tracks]
Options:
-1     Encode the whole CD in a single file
-a <action1[,action2]...>
       Actions to perform:
       cddb,read,normalize,encode,tag,move,replaygain,playlist,clean
-b     Enable batch normalization
-c <file>
       Specify a configuration file (overrides system and user config files)
-C <discid#>
       Specify discid to resume from (only needed if you no longer have the cd)
-d <device>
       Specify CDROM device to grab (flac uses a single-track flac file)
-D     Debugging mode (equivalent to sh -x abcde)
-e     Erase encoded track information from status file
-f     Force operations that otherwise are considered harmful. Read "man abcde"
-g     Use "lame --nogap" for MP3 encoding. Disables low disk and pipes flags
-h     This help information
-j <#> Number of encoder processes to run at once (localhost)
-k     Keep the wav tracks for later use
-l     Use low disk space algorithm
-L     Use local CDDB storage directory
-n     No lookup. Don't query CDDB, just create and use template
-N     Noninteractive. Never prompt for anything
-m     Modify playlist to include CRLF endings, to comply with some players
       WARNING: Deprecated. Use "cue" action
-o <type1[,type2]...>
       Output file type(s) (vorbis,mp3,flac,spx,mpc,wav,m4a). Defaults to vorbis
-p     Pad track numbers with 0's (if less than 10 tracks)
-P     Use UNIX pipes to read+encode without wav files
-q <level>
       Set quality level (high,medium,low)
-r <host1[,host2]...>
       Also encode on these remote hosts
-R     Use local CDDB in recursive mode
-s <field>
       Show fields from the CDDB info (year,genre)
-S <#> Set the CD speed
-t <#> Start the track numbering at a given number
-T <#> Same as -t but modifies tag numbering
-U     Do NOT use UNICODE (UTF8) tags and comments
-v     Show version number and exit
-V     Be a bit more verbose about what is happening behind the scenes
-x     Eject CD after all tracks are read
-w <comment>
       Add a comment to the CD tracks
-W <#> Concatenate CDs: -T #01 -w "CD #"
-z     Use debug CDROMREADERSYNTAX option (needs cdparanoia)

Tracks is a space-delimited list of tracks to grab.
Ranges specified with hyphens are allowed (i.e., 1-5).

END
